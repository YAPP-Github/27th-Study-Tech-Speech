클린 아키텍처를 사용을 하면서 몇가지 어 이건 좀 아닌데 어 이걸 왜 쓰지 라고
고민됐던 포인트들이 몇개 있어요 그래서 그것들을 중점적으로 한번
고민을 계속 하고 있었는데 이거에 대해서 저랑 같이 우테코를 수료
했던 크루가 저랑 같은 고민을 하고 그거에 대해서 해결
방안을 나름대로 고민을 하고 프로젝트에서 실제로 사용을 했었는데
그거에 대한 걸 이제 같이 얘기를 나누게 되다가 이렇게 준비를 하게 됐습니다

그래서 먼저 제가 말씀드린 그 고민했던 부분들이 바로 useless usecase와 anemic domain model 두가지 였어요 
근데 이거에 대한 내용은 23년에 박종혁 님이란 분께서 연사하신 내용이 있는데 이거 되게 재밌거든요
그래서 이거 한번쯤 보시는 걸 추천드립니다 

그래서 간단하게 사람마다 각 조금씩 다를 수는 있겠지만 제가 사용했던 클린 아키텍처의 패턴에 대해서 간략하게 소개를 드릴게요.
그래서 뭐 클린 아키텍처에서 얘기하는 것처럼 도메인은 외부의 의존성을 가지지 않고 이제 프레젠테이션과 데이터가 양쪽에서 도메인을 바라보는 형태로 이루어져 있어요.

어 이거 방향이 왜 이러지 어 이거 이쪽에 있는 얘가 여기 있어야 됐는데 이거 잘못했네요 아무튼 이렇게 우리가 보통 repository 인터페이스를 도메인에 만들고 이 데이터 레이어의
구현체를 만들게 되는데 이렇게 되면 ViewModel이나 유즈케이스에서는 이 레퍼스토리의 구현체를 바라보는 게 아니라 인터페이스 
그러니까 고수준 API를 바라보는 거기 때문에 이제 그 객체 지향 원칙에서 흔히 얘기하는그 DIP를 지킬 수가 있어요 

그래서 이러한 구조를 패키지 트리 형태로 간단하게 추상화를 하면 뭐 이 정도가 될 것 같아요
뭐 유저 리스폰스가 있고 데이터 레이어의 리스폰스 타입이 있고 데이터 리스폰스와 레퍼스토리가 있고 도메인은 도메인 모델이 있고
똑같이 레퍼스토리 인터페이스와 유즈케이스 프레젠테이션에서는 UI 상태나 ViewModel 뭐 이 정도가 있을 것 같아요.

그럼 본격적으로 이 두 가지 문제점에 대해서 좀 알아볼게요
먼저 첫 번째로 유즐레스 유즈케이스인데 우선 유즈케이스란 무엇일까
유즈케이스는 제가 생각하기엔 어떤 비즈니스 로직을 재사용할 수 있도록 하나의 단위로 캡슐한 객체라고 생각을 해요

예를 들어서 지금 유저가 이메일로 로그인을 한다, 이때 입력된 이메일이 유효해야 한다
어떤 우리가 정해진 규칙에 의해서 유효해야 한다
이메일이 유효하다면 서버에 로그인 요청을 보낸다

이런 식으로 어떤 비즈니스 로직이 있을 수가 있겠죠
그래서 이런 비즈니스 로직을 하나의 객체로 캡슐한다면
만약에 이러한 비즈니스 로직이 지금은 로그인에 대한 비즈니스 로직
이메일 유효성 검증에 대한 비즈니스 로직이지만

만약에 이게 어디선가 여러 번 재사용된다면 이 코드를 이러한 코드를 매번 작성해야 된다는 불편함이 있어요

그래서 만약에 이 코드가 수정이 된다면 이 동일한 비즈니스 로직을 가지는 viewModel마다 이 코드를 수정해야 되는 불편함이 있겠죠
그래서 이런 비즈니스 로직을 하나의 단위로 묶어서 재사용 가능하도록 한 게 저는 유즈케이스라고 생각을 합니다.

그런데 만약에 유즈케이스를 사용할 때 이렇게 명확하게 여러 가지 비즈니스 로직이 있다면 괜찮은데
보통은 이런 식으로 레퍼스토리를 호출하기만 하는 유즈케이스들이 종종 있어요

이런 것들을 이제 useless usecase 그러니까 불필요한 도메인 모델 아니 도메인 모델이란다
유즈케이스라고 하는데 제가 생각하기에 이런 유즈케이스는 그냥 레퍼스토리를 호출하기만 하는 중간 다리밖에 안 된다

그래서 이는 유즈케이스에서 얘기하는 명확한 비즈니스 로직을 캡슐한 단위가 아니라고 저는 생각을 합니다
물론 그렇다고 해서 이런 유즈케이스를 절대 만들지 말라 그런 얘기는 또 아니에요
왜냐하면 이런 유즈케이스도 있어야 된다라고 생각하는 관점의 분들은 제가 생각하기엔

이런 유즈케이스도 만약에 위에 있는 이런 명확한 복잡한 어떤 비즈니스 로직이 있는 상황처럼
뭔가 여기 이 상태에서 비즈니스 로직이 추가된다면 이 유즈케이스만 수정하면 되니까
사용해도 된다라고 얘기하는 분들도 있는 것 같아요 

근데 제가 생각하기엔 그건 어디까지나 미래에 대한 확장 가능성을 열어놓는 행위다라고 생각을 하는데
그 확장 가능성을 너무 과도하게 열어놓는 건 오버 엔지니어링이라고 생각을 합니다

그래서 그 다음으로 알아볼 내용은 이제 아네믹 도메인 모델이라는 거예요 한국어로는 약간 빈약한 빈혈 도메인 모델 그 정도로 얘기를 하는데 여기서 말하는 아네믹 도메인 모델은 이런 아이들이에요
얘네들은 데이터만 있고 이런 어떤 비즈니스 로직 같은 게 전혀 없어요

도메인 모델이라고 하는 건 우리가 어떤 비즈니스 로직을 캡슐한 단위여야 된다고 생각을 하는데
그래서 이런 클린 아키텍처를 사용하다 보면 데이터 레이어에 있는 DTO를 이제 도메인에 있는 타입으로 반환을 해서 UI에서 그걸 가져다가 UI 스테이트 같은 형태로 사용하게 되는데
사실 이런 패턴이 반복되는 이유는 제가 생각하기엔 이제 안드로이드와 서버 관계 속에서 이제 서버에서 받은 데이터를
저희는 거의 진짜 순수하게 화면에 보여주는 경우가 종종 있어요

근데 이럴 경우에는 사실 그냥 화면에 가져다가 보여주기만 하기 때문에 뭔가 우리가 특정한 책임을 부여하는 것이 사실 불가능하다고 저는 계속 생각을 해왔습니다
그래서 이런 것들 이런 불필요한 유즈케이스 아무 일도 안 하는 이런 도메인 모델들 사실상 저는 그냥 빈 껍데기라고 생각을 해서

이게 그냥 이 클린이라는 단어 그 자체로 깨끗한 아키텍처일까? 라는 생각이 조금 들더라고요

그래서 이거를 조금 더 객체지향 관점에서 생각을 해보면
이제 제가 전에 그 객체지향과 사실과 오해라는 책을 조금 읽다가
중간에 탈주를 하긴 했지만 그래도 조금 읽어봤는데 여기서 말하는 객체지향이란 게 객체지향은 이제 비즈니스 로직을 객체라는 단위로 묶어서 표현을 한다고 저는 생각을 해요.

그래서 그리고 그 객체는 상태와 행동으로 묶인다 그러니까 어떠한 데이터가 있을 거고 그 데이터들을 다루는 어떤 메서드들로 묶여야 된다고 소개를 하는데
이러한 객체들은 이제 어떠한 곳에 종속적이지 않은 자율적인 존재다 라고 표현을 하시는데

이런 자율적인 객체를 이제 상태와 행위를 함께 지니면서 스스로 자기 자신을 책임 지는 객체를 의미한다고 얘기를 합니다
근데 이 관점에서 봤을 때 지금 도메인 모델은 보시면 물론 상태는 있지만 어떠한 행동이 없습니다.

그래서 이런 부분들을 저는 개선을 하고 싶었는데 핵심 아이디어에 대한 개선 아이디어는 일단 이러한 유즐레스 유스케이스는
진짜 우리가 어떤 비즈니스 로직의 단위로 묶어야 된다 어떤 재사용 가능한 비즈니스 로직이 있어야 된다 라고 했을 때만 추가를 하고

그리고 이러한 도메인 모델을 일단 없애고 한번 생각을 해봤어요 없애면? 그럼 어떻게 데이터를 받아오지?

아, UI에서 그냥 직접 받아오자 굳이 중간다리를 거칠 필요가 없다
그러면 의중성 방향이 이런 식으로 수정이 되거든요 이 도메인을 직접 도메인은 있어도 되고 없어도 되고

근데 프레젠테이션, UI가 데이터 레이어에서 데이터를 직접 받아오니까 이런 식으로 수정이 되더라고요

그리고 이런 형태가 되면 이제 UI에서 맵퍼가 구현이 될 거고 이제 도메인에 있던 레포지터리 인터페이스도 이제 더 이상 도메인에 있을 필요가 없어져서
도메인이 필수가 아니게 되어버렸으니까 데이터 레이어로 이동을 하게 됩니다

어, 살짝 생략을 들어가긴 했는데 제가 여기서 말하는 이 도메인 모델은 도메인 모델이 사라졌다는 의미가
그러니까 데이터 레이어에서 도메인을 걸쳐서 UI로 맵핑이 될 때 이 중간다리 역할을 하는 도메인을 없애자는 거예요

그리고 우리가 만드는 도메인 모델은 어, 예를 들어서 여기서 얘기하는 이런 이메일 검증 같은 책임을 가진 어떤 비즈니스로직을 가진
이메일이라는 객체를 만드는 거겠죠, 여기서는 이메일이라는 클래스를 만들어서 이 안에서 유효성 검사를 하게 하면은 그건 진짜 비즈니스로직을 가진 객체라고 생각을 해서
어, 그렇게 해도 되지 않을까? 라고 생각을 하게 됐어요

### 질문
Q1. 그러면 클린 아키텍처를 제가 공부했을 때는 레이어를 분리하는 이유가 어떠한 그냥 그 레이어들끼리의 의존성만 유지가 되면은
뭐 어떤 프레이머클을 쓰든 라이브러리든 그게 유지가 된다라고 해서 레이어를 분리하를 했었던 거 같거든요
그렇게 됐을 때 혹시 이제 안드로이드 프로젝트를 계속했다가 말씀해 주신 프레젠테이션 형태, 프레젠테이션에서 데이터를 바로 써는 형태가 됐을 때
KMP로 마이그레이션 하는 관점에서는 혹시 어떠한 단점이 있을까요?

제가 생각하는, 제가 알고 있는 클린 아키텍처도 뭐 데이터 레이어나 프레젠테이션 둘 중에 하나가 다른 어떤 iOS로 바뀌어도
그대로 작동을 해야 된다 그게 클린 아키텍처의 기본 기조다 라고 배우게 됐어요

근데 뭔가 저도 이번에 든 생각이 그렇게까지 그렇게 설계 의도는 알겠는데
그렇게 하지 않을 거라면 굳이 처음부터 그렇게 설계를 할 필요가 있을까?라는 생각을 하게 돼서 뭔가 그렇게도 생각을 하게 됐고

일단 KMP를 어... 제가 사용해 본 적이 없어서 뭔가 고려를 해 본 적이 없어서
살짝 질문이, 답변이 산으로 가는데 어 그러게요. 어떻게 하면 좋을까요?
음...
근데 그때는 뭔가 의존선 방향을 좀 수정을 시켜야 되긴 할 것 같아요

왜냐면 클린 아키텍처가 아마 그렇게 KMP로 마이그레이션 하기에 가장 좋은 형태인 건 맞다 라고 생각을 해서
음... 이거는 조금 제가 경험해 보지가 않아서 잘 모르겠지만 근데
그냥 추측을 해 보자면 의존성 방향을 조금 레이어 간의 의존성을 다시 재설계해야 될 것 같긴 합니다

Q2. 혹시 유즈케이스가 객체 지향적인지 혹시 여쭤본 걸까요?
혹시 질문을 한 번만 더 말씀해 주실 수 있을까요? 제가 이해를 못해서
유즈케이스를 어떻게 만드냐에 따라 조금 다를 것 같긴 한데
만약에 일단 여기서 제가 말씀드린 객사호 흔히 줄여서 객체량의 사실과 오해를 줄여서 객사오라고 하는데
객사오에서 얘기하는 객체는 어쨌든 상태와 행위를 동시에 가져야 된다라고 명확히 얘기를 하고 있거든요.

그래서 만약에 유지케이스 내부에 뭔가 상태를 계속해서 가지고 있거나
상태를 계속해서 가지고 있고 그거를 다루는 어떤 메서드가 있으면 객체지향적이다라고 얘기를 할 수 있을 것 같은데
근데 유지케이스 안에서 상태를 계속해서 가지고 있는 것보단 그걸 차라리 그냥 객체로 만들어서 묶는 게 좀 더 나을 거란 생각이 들어서 유지케이스가 객체지향적이다.
저도 잘 모르겠어요.
